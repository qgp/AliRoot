# $Id$
 
##### RULES #####
 
.SUFFIXES: .cxx .h

# IRST coding rule check
export IRST_INSTALLDIR=$(ALICE)/local/IRST
export CLASSPATH=$(IRST_INSTALLDIR)
CODE_CHECK=java rules.ALICE.ALICERuleChecker
REV_ENG=$(IRST_INSTALLDIR)/scripts/revEng.sh
# This is to avoid a problem with the declaration of .SECONDARY in the 
# GeneralMacros
CHECKS = none


$(ALICE_ROOT)/include/%.h : %.h
	@[ -d $(dir $@) ] || mkdir $(dir $@)
	@cp -p $? $(ALICE_ROOT)/include
 
tgt_$(ALICE_TARGET)/%Cint.o : %Cint.cxx
	@echo $*Cint.cxx
	@[ -d $(dir $@) ] || mkdir -p $(dir $@)
ifeq ($(CXXVERBOSE),)
	@$(CXX) $(filter-out -prof_gen, $(filter-out -O%, $(CXXFLAGS))) -O0 -c $*Cint.cxx -o tgt_$(ALICE_TARGET)/$*Cint.o
else
	$(CXX) $(filter-out -prof_gen, $(filter-out -O%, $(CXXFLAGS))) -O0 -c $*Cint.cxx -o tgt_$(ALICE_TARGET)/$*Cint.o
endif

tgt_$(ALICE_TARGET)/%.o : %.cxx
	@echo $*.cxx
	@[ -d $(dir $@) ] || mkdir -p $(dir $@)
ifeq ($(CXXVERBOSE),)
	@$(CXX) $(CXXFLAGS) -c $*.cxx -o tgt_$(ALICE_TARGET)/$*.o
else
	$(CXX) $(CXXFLAGS) -c $*.cxx -o tgt_$(ALICE_TARGET)/$*.o
endif

# IRST coding rule check 
check/%.i : %.cxx
	@[ -d $(dir $@) ] || mkdir -p $(dir $@)
	@$(CXX) -E $(CXXFLAGS) $*.cxx > check/$*.i

# IRST coding rule check
check/%.viol : check/%.i
	@$(CODE_CHECK) check/$*.i ./ > check/$*.viol

tgt_$(ALICE_TARGET)/%.o : %.c
	@echo $*.c
	@[ -d $(dir $@) ] || mkdir -p $(dir $@)
	@$(CC) $(CFLAGS) -c $*.c -o tgt_$(ALICE_TARGET)/$*.o

tgt_$(ALICE_TARGET)/%.o : %.f
	@echo $*.f
	@[ -d $(dir $@) ] || mkdir -p $(dir $@)
	@$(F77) $(FFLAGS) -c $*.f -o tgt_$(ALICE_TARGET)/$*.o

tgt_$(ALICE_TARGET)/%.o : %.F
	@echo $*.F
	@[ -d $(dir $@) ] || mkdir -p $(dir $@)
	@$(F77) $(FFLAGS) -c $*.F -o tgt_$(ALICE_TARGET)/$*.o

# Needed binary directories
LIBDIR = $(ALICE_ROOT)/lib/tgt_$(ALICE_TARGET)
BINDIR = $(ALICE_ROOT)/bin/tgt_$(ALICE_TARGET)


# Current Version

VERSION		= 3.03pre
 
# Which makedepend
MAKEDEPEND    = $(ROOTSYS)/bin/rmkdepend

# Root libraries
 
ROOTLIBS      = $(shell $(ROOTSYS)/bin/root-config --glibs) -lMinuit -lHtml
ROOTLIBS      := $(filter-out -lNew,$(ROOTLIBS))
ROOTLIBS      := $(filter-out -lThread,$(ROOTLIBS))
ROOTLIBS      := $(filter-out -lpthread,$(ROOTLIBS))
ROOTLIBS      += -lMC 

# Alice libraries

# without geant3
ALILIBS	= -L$(LIBDIR) -L$(ALICE)/geant3/lib/tgt_Linux \
  -lMUON -lTPC -lPMD -lTRD -lFMD -lTOF \
  -lPHOS -lRICH -lZDC -lSTRUCT \
	          -lSTART -lEVGEN -lSTEER -lCONTAINERS
#-lEMCAL 

# CERN Libraries 

CLIBS         = -lmicrocern
G3LIBS        = -lgeant321

